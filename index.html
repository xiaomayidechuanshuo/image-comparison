<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片对比查看器</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {box-sizing:border-box;margin:0;padding:0;}
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#111;color:#eee;min-height:100vh;padding:20px;
    }
    .container {max-width:1200px;margin:0 auto;}
    header {text-align:center;margin-bottom:20px;}
    h1 {font-size:26px;color:#fff;}
    .comparison-container {display:flex;flex-wrap:wrap;gap:20px;}
    .comparison-item {
      flex:1 1 calc(50% - 20px);min-width:300px;
      border-radius:12px;overflow:hidden;background:#000;
      position:relative;
    }
    .comparison-header {
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 15px;background:#222;color:#eee;
    }
    .image-comparison {position:relative;width:100%;overflow:hidden;}
    .image-container {
      position:relative;width:100%;height:0;padding-bottom:75%;
    }
    .image-container img {
      position:absolute;top:0;left:0;width:100%;height:100%;
      object-fit:contain;background:#000;
    }
    .image-before {
      clip-path: inset(0 50% 0 0); /* 初始显示左半部分 */
      will-change: clip-path;
    }
    .slider {
      position:absolute;top:0;left:50%;width:2px;height:100%;
      background:rgba(255,255,255,0.7);cursor:ew-resize;z-index:3;
    }
    .slider-handle {
      position:absolute;top:50%;left:50%;
      width:28px;height:28px;border-radius:50%;
      background:#fff;border:2px solid #3498db;
      transform:translate(-50%,-50%);box-shadow:0 2px 8px rgba(0,0,0,0.3);
    }
    .image-caption {
      display:flex;justify-content:space-between;
      padding:8px 12px;background:#222;color:#ccc;font-size:14px;
    }
    .before-label{color:#e74c3c;}
    .after-label{color:#27ae60;}
    /* 全屏模式 */
    .fullscreen-mode {
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.95);z-index:1000;
      display:none;justify-content:center;align-items:center;
      flex-direction:column;
    }
    .fullscreen-content {width:95%;height:90%;position:relative;}
    .fullscreen-comparison {width:100%;height:100%;position:relative;}
    .fullscreen-comparison .image-container {height:100%;padding-bottom:0;}
    .close-fullscreen {
      position:absolute;top:20px;right:20px;
      width:40px;height:40px;border:none;border-radius:50%;
      background:rgba(255,255,255,0.2);color:#fff;cursor:pointer;
      font-size:20px;display:flex;align-items:center;justify-content:center;
    }
    @media(max-width:768px){.comparison-item{flex:1 1 100%;}}
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>图片对比查看器</h1>
  </header>
  <div class="comparison-container" id="comparisonContainer"></div>
</div>

<!-- 全屏模式 -->
<div class="fullscreen-mode" id="fullscreenMode">
  <button class="close-fullscreen"><i class="fas fa-times"></i></button>
  <div class="fullscreen-content">
    <div class="fullscreen-comparison">
      <div class="image-container">
        <img class="image-after" src="" alt="">
        <img class="image-before" src="" alt="">
        <div class="slider"><div class="slider-handle"></div></div>
      </div>
      <div class="image-caption">
        <span class="before-label">Before</span>
        <span class="after-label">After</span>
      </div>
    </div>
  </div>
</div>

<script>
const groups = [
  {id:"00", before:"images/00/before.png", after:"images/00/after.png"},
  {id:"01", before:"images/01/before.png", after:"images/01/after.png"}
];

function createComparisonItem(group){
  const item=document.createElement("div");
  item.className="comparison-item";item.dataset.groupId=group.id;
  item.innerHTML=`
    <div class="comparison-header">
      <div>对比组 ${group.id}</div>
      <button class="fullscreen-btn" title="全屏"><i class="fas fa-expand"></i></button>
    </div>
    <div class="image-comparison">
      <div class="image-container">
        <img class="image-after" src="${group.after}">
        <img class="image-before" src="${group.before}">
        <div class="slider"><div class="slider-handle"></div></div>
      </div>
    </div>
    <div class="image-caption">
      <span class="before-label">Before</span>
      <span class="after-label">After</span>
    </div>
  `;
  return item;
}

function initSlider(item){
  const beforeImg=item.querySelector(".image-before");
  const slider=item.querySelector(".slider");
  const container=item.querySelector(".image-container");
  let isDragging=false,percent=50,rafId=null;

  function update(p){
    beforeImg.style.clipPath=`inset(0 ${100-p}% 0 0)`;
    slider.style.left=p+"%";
  }
  update(percent);

  function moveHandler(x){
    const rect=container.getBoundingClientRect();
    let p=((x-rect.left)/rect.width)*100;
    p=Math.max(0,Math.min(100,p));percent=p;
    if(!rafId){
      rafId=requestAnimationFrame(()=>{
        update(percent);rafId=null;
      });
    }
  }

  slider.addEventListener("mousedown",e=>{isDragging=true;e.preventDefault();});
  window.addEventListener("mouseup",()=>isDragging=false);
  window.addEventListener("mousemove",e=>{if(isDragging)moveHandler(e.clientX);});

  slider.addEventListener("touchstart",e=>{isDragging=true;e.preventDefault();});
  window.addEventListener("touchend",()=>isDragging=false);
  window.addEventListener("touchmove",e=>{if(isDragging)moveHandler(e.touches[0].clientX);});
}

function initAll(){
  const container=document.getElementById("comparisonContainer");
  groups.forEach(g=>{
    const item=createComparisonItem(g);
    container.appendChild(item);
    initSlider(item);
    item.querySelector(".fullscreen-btn").addEventListener("click",()=>openFullscreen(item));
  });
}

function openFullscreen(item){
  const fs=document.getElementById("fullscreenMode");
  const before=fs.querySelector(".image-before");
  const after=fs.querySelector(".image-after");
  const originalBefore=item.querySelector(".image-before").src;
  const originalAfter=item.querySelector(".image-after").src;
  before.src=originalBefore;after.src=originalAfter;
  fs.style.display="flex";document.body.style.overflow="hidden";
  initSlider(fs);
}
document.querySelector(".close-fullscreen").addEventListener("click",()=>{
  const fs=document.getElementById("fullscreenMode");
  fs.style.display="none";document.body.style.overflow="auto";
});
document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){document.querySelector(".close-fullscreen").click();}
});

initAll();
</script>
</body>
</html>
